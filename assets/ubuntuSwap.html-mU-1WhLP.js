import{_ as s,o as a,c as n,e}from"./app-Cxb9Ozmt.js";const l={},i=e(`<h1 id="ubuntu-实例中添加-swap-分区的方法" tabindex="-1"><a class="header-anchor" href="#ubuntu-实例中添加-swap-分区的方法"><span>Ubuntu 实例中添加 swap 分区的方法</span></a></h1><ol><li><p>依次执行一下命令，创建一个空文件，锁定文件的大小</p><blockquote><p>说明：文件的具体大小建议设定为内存的两倍。此处的1K×4M＝4GiB。</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-v</span> /var/cache/swap</span>
<span class="line"><span class="token builtin class-name">cd</span> /var/cache/swap</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>swapfile <span class="token assign-left variable">bs</span><span class="token operator">=</span>1K <span class="token assign-left variable">count</span><span class="token operator">=</span>4M</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行以下命令，将新建的文件转换为 swap 文件</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> <span class="token function">mkswap</span> swapfile</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>执行以下命令，给文件授权</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> swapfile</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>执行以下命令，启用 swap 分区</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> <span class="token function">swapon</span> swapfile</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>执行以下命令，进行验证</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">swapon</span> <span class="token parameter variable">-s</span></span>
<span class="line"><span class="token function">top</span> <span class="token parameter variable">-bn1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> swap</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出如下</p><blockquote><p>KiB Swap: 4194300 total, 4194300 free</p></blockquote></li><li><p>执行以下命令，将该分区设置成开机自启</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;/var/cache/swap/swapfile none swap sw 0 0&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/fstab</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>执行以下命令，测试开机是否加载 swap 分区</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> swapoff swapfile </span>
<span class="line"><span class="token function">sudo</span> <span class="token function">swapon</span> <span class="token parameter variable">-va</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>如果您需要修改 swap 使用率，编辑 <code>/etc/sysctl.conf</code> 文件，修改 vm.swappiness 值</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token assign-left variable">vm.swappiness</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token variable">$NUM</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>说明：$NUM 的取值范围为 0-100，0 表示最大限度使用物理内存，100 表示积极的使用 swap 分区。</p></blockquote></li></ol>`,2),t=[i];function p(c,o){return a(),n("div",null,t)}const d=s(l,[["render",p],["__file","ubuntuSwap.html.vue"]]),u=JSON.parse('{"path":"/blogs/ops/ubuntuSwap.html","title":"Ubuntu 实例中添加 swap 分区的方法","lang":"zh-CN","frontmatter":{"title":"Ubuntu 实例中添加 swap 分区的方法","date":"2024/4/13","tags":["Linux"],"categories":["ops"]},"headers":[],"git":{"createdTime":1712999404000,"updatedTime":1722134881000,"contributors":[{"name":"reine-ishyanami","email":"2402979195@qq.com","commits":2}]},"filePathRelative":"blogs/ops/ubuntuSwap.md"}');export{d as comp,u as data};
